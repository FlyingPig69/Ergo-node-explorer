<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.01, maximum-scale=1.5" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_sheet.css') }}" />
    <title>Ergo Node Explorer</title>
    <style>

    body {
    background: -moz-linear-gradient(45deg, #026a8d 0%, #005b7a 29%, #00263a 66%, #000f1a 100%);
    background: -webkit-linear-gradient(45deg, #026a8d 0%, #005b7a 29%, #00263a 66%, #000f1a 100%);
    background: linear-gradient(45deg, #026a8d 0%, #005b7a 29%, #00263a 66%, #000f1a 100%);
        background-size: 400% 400%;
        -webkit-animation: Gradient 15s ease infinite;
      -moz-animation: Gradient 15s ease infinite;
      animation: Gradient 15s ease infinite;
      /*min-height: calc(100vh - 2rem);*/
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: space-evenly;
      overflow: hidden;
      position: relative;
    }

    body::before,
    body::after {
      content: "";
      width: 80vmax;
      height: 90vmax;
      position: absolute;
      background: rgba(255, 255, 255, 0.07);
      left: -20vmin;
      top: -20vmin;
      animation: morph 15s linear infinite alternate, spin 20s linear infinite;
      z-index: 1;
      will-change: border-radius, transform;
      transform-origin: 55% 55%;
      pointer-events: none;
    }

    body::after {
        width: 70vmin;
        height: 70vmin;
        left: auto;
        right: -10vmin;
        top: auto;
        bottom: 0;
        animation: morph 10s linear infinite alternate, spin 26s linear infinite reverse;
        transform-origin: 20% 20%;
    }

    @-webkit-keyframes Gradient {
      0% {
        background-position: 0 50%
      }
      50% {
        background-position: 100% 50%
      }
      100% {
        background-position: 0 50%
      }
    }

    @-moz-keyframes Gradient {
      0% {
        background-position: 0 50%
      }
      50% {
        background-position: 100% 50%
      }
      100% {
        background-position: 0 50%
      }
    }

    @keyframes Gradient {
      0% {
        background-position: 0 50%
      }
      50% {
        background-position: 100% 50%
      }
      100% {
        background-position: 0 50%
      }
    }

    @keyframes morph {
      0% {
        border-radius: 40% 60% 60% 40% / 70% 30% 70% 30%; }
      100% {
        border-radius: 40% 60%; }
    }

    @keyframes spin {
      to {
        transform: rotate(1turn);
      }
    }
      .st0{display:none;}
      .st1{display:inline;}
      .st2{opacity:0.29;}
      .st3{fill:#FFFFFF;}
      .st4{clip-path:url(#SVGID_2_);fill:#FFFFFF;}
      .st5{clip-path:url(#SVGID_4_);}
      .st6{clip-path:url(#SVGID_6_);}
      .st7{clip-path:url(#SVGID_8_);}
      .st8{clip-path:url(#SVGID_10_);}
      .st9{fill:none;}
      .st10{clip-path:url(#SVGID_12_);}
      .st11{opacity:0.7;}
      .st12{clip-path:url(#SVGID_14_);}
      .st13{opacity:0.2;}
      .st14{clip-path:url(#SVGID_16_);}
      .st15{opacity:0.3;fill:#FFFFFF;enable-background:new    ;}

        .container {
            margin-top: 150px;
            text-align:center;
        }

        .card-container {
            width: 1100px;
            margin-top: 20px;
            padding: 10px;
            text-align: center;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 0 auto;
        }


        .card-text-height {
            width:200px;
            vertical-align:top;
            font-size: 12px;
        }

        .card-title,
        .card-text a,
        .card-text span {
            margin-bottom: 10px;
            margin-top: 10px;
            vertical-align: top;
        }


    .card-body-top {
        display: flex;
        flex-direction: column;
        max-width: 100%;
        margin-bottom: 10px;
        margin-top: 10px;
        height: 110px;
        box-shadow: 1px 4px 6px rgba(0, 0, 0, 0.5);
        background-color: #ffffff;
        border-radius: 10px;
        align-items: center;
    }

        @media (min-width: 768px) {
            .card-bottom {
                max-width: 800px;
            }
        }

        body {
            margin: 0;
            font-family: 'Arial', sans-serif; /* Change to your desired font */
        }

        .container {
            margin-top: 150px;
            text-align: center;
            justify-content: center;
        }

        /* Add styles for your cards and other elements here */

        /* Example style for card titles */
        .card-title {
            font-size: 24px;
            color: #004080; /* Change to your desired title color */
        }

        /* Example style for links */
        a {
            color: #0066cc; /* Change to your desired link color */
            text-decoration: none;
        }


    </style>
</head>

<body>
    <div class="header">
        <b><a target="_self" href="{{flask_url}}" style="color:white;"> <img src="{{ url_for('static', filename='ergo_white.png') }}" height="50" width="50" style="vertical-align: middle; margin-bottom:10px; margin-top:10px;">&nbsp;Node Explorer</a></b>

        <div class="search-card">
            <form method="get" action="/search" onsubmit="return validateForm()" class="search-form">
                <div class="flex-container">
                    <input type="text" name="search_text" id="search_text" class="form-control custom-search-box" placeholder="Search text...">
                    <select name="search_type" id="search_type" class="form-control custom-search-lov">
                        <option value="transaction_id">Transaction ID</option>
                        <option value="address">Address</option>
                        <option value="box_id">Box ID</option>
                    </select>
                    <button type="submit" class="btn btn-dark custom-search-btn">Search</button>
                </div>
                <br>
            </form>
        </div>
    </div>

    <div class="container" >
        <div class="card-container style="margin: 0 auto;">
            <!-- Card 1: Node Name -->
            <div class="card-body-top">
                <h2 class="card-title"><b>Node Info</b></h2>
                <div class="card-text">
                    {{ info_data.name }}<br>
                    {{ base_url }}<br>
                    Indexed Height: {{indexed_height}}
                    </div>
            </div>

            <!-- Card 2: TXs in Mempool -->
            <div class="card-body-top">
                <h2 class="card-title"><b>TXs in Mempool</b></h2>
                {{ info_data.unconfirmedCount }}
            </div>

            <!-- Card 3: Difficulty -->
            <div class="card-body-top">
                <h2 class="card-title"><b>Difficulty</b></h2>
                {{ info_data.difficulty }}
            </div>
        </div>
        <!-- Card below with Latest Blocks -->
        <div class="card-body-bottom">

            {% if indexed_height < height[0] %}
                <p style="color: red; font-weight: bold;">Node is not fully indexed, transactions and block info may be missing.</p>
            {% endif %}
         <table style="border-collapse: collapse; width: 1075px; margin-left:50px; box-shadow: 1px 4px 6px rgba(0, 0, 0, 0.5); margin: 0 auto; background-color:#ffffff; border-radius:10px; height:300px;">
            <thead>
                <tr>
                    <td colspan="5" style="border: none;">
                        <div class="card-title" style="text-align: center;"><b>Latest Blocks</b></div>
                    </td>
                </tr>
            </thead>
            <tbody>
                {% for header_id in header_id %}
                <tr>

                    <td style="width: 300px;  border: none; font-size: 20px; text-align: left;"></td>
                    <td style="width: 75px;  border: none; font-size: 20px; text-align: left;"><a href="{{flask_url}}/blocks/{{header_id}}">{{ height[loop.index0] }}</a></td>
                    <td style="width: 150px; border: none; font-size: 20px; text-align: left;">{{no_txs[loop.index0]}} Transactions</td>
                    <td style="width: 250px; border: none; font-size: 20px; text-align: left;"><span id="timestamp_{{loop.index0}}">{{timestamp[loop.index0]}}</span></td>

                    <td style="width: 300px;  border: none; font-size: 20px; text-align: left;"></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <div class="white-text" style="text-align: center">
            <br>
            Early version, may crash or be taken down at any point, but so far it's been pretty reliable.<br>
            <span style="color:red;"><b>Transaction lists do not include unconfirmed transactions...yet!</b> </span>
            <div>
                 <a target="_blank" href="https://github.com/FlyingPig69/ergo-node-explorer" style="color:white;">
                <img src="{{ url_for('static', filename='github-mark-white.png') }}" height="30" width="30">
            </a>           <i>- FlyingPig</i><br><br>
            </div>


            <br><br>
        </div>
    </div>

    <script>
        function validateForm() {
            var searchText = document.getElementById('search_text').value;

            if (searchText.trim() === '') {
                alert('Please enter a search term.');
                return false;
            }

            return true;
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Get all timestamp elements
            var timestamps = document.querySelectorAll('[id^="timestamp_"]');

            timestamps.forEach(function (timestampElement) {
                var timestamp = parseInt(timestampElement.innerText);

                // Convert timestamp to local time
                var localTime = new Date(timestamp);

                // Format time and date separately
                var timeString = localTime.toLocaleTimeString();
                var dateString = localTime.toLocaleDateString();

                // Update the content of the element with time and date
                timestampElement.innerText = timeString + '\u00A0\u00A0\u00A0' + dateString;
            });
        });
    </script>
</body>

</html>
